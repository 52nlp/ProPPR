\documentclass{article}
\usepackage{amssymb,amsmath}
\title{minalpha projection step rationale}
\author{Chao-Yuan Wu, Kathryn Mazaitis}
\begin{document}
\maketitle

\section*{Premise}
Given weight $w_r$ for the restart edge and $w_i$ for other outgoing edges $i$, we assert that the ratio of the reset weight to the total outgoing edge weight is $\alpha$:

$$\frac{f(w_r)}{f(w_r) + \sum\limits_i f(w_i)} = \alpha$$

\section*{Solution 1: Single-feature fanout}
In Chao-Yuan Wu's initial implementation, we made the assumption that the edges $w_i$ would contain a single (generally fact- or graph-) feature, such that $\sum\limits_i f(w_i)$ is simply the number of outgoing edges $i$ times the wrapped weight $f(w_i)$. This permits the solution:

\begin{align*}
\frac{f(w_r)}{f(w_r) + \sum\limits_i f(w_i)} & =   \alpha\\
\frac{f(w_r)}{f(w_r) + n f(w_i)} & =   \alpha\\
f(w_i) &= \frac{(1-\alpha)f(w_r)}{n \alpha}\\
w_i &= f^{-1}\left(\frac{(1-\alpha)f(w_r)}{n \alpha}\right)
\end{align*}

\section*{Multi-feature fanout}
Now we will expand our implementation to accept nodes with multiple outgoing non-reset features.

\subsection*{Solution 2: Suppress non-reset features in ratio} 
First we will consider an analogue of solution 1 where the non-reset features are reduced. We will maintain their internal ratio. Let $n_k$ be the number of edges labeled with feature $\theta_k$, such that the total non-reset outgoing weight becomes $\sum\limits_k n_kf(\theta_k)$:

\begin{align*}
\frac{f(w_r)}{f(w_r) + \sum\limits_k n_kf(\theta_k)} &= \alpha\\
\sum\limits_k n_kf(\theta_k) &= \frac{(1-\alpha)f(w_r)}{\alpha}
\end{align*}

We will maintain the ratios between outgoing non-reset features between the old feature values $\theta'$ and the new feature values $\theta$ by making the assertion

$$\frac{n_kf(\theta_k)}{\sum\limits_j n_jf(\theta_j)} = \frac{n_kf(\theta_k')}{\sum\limits_j n_jf(\theta_j')}$$

In the code, the expression $(z-\mathrm{rw})$ represents the current (constraint-violating) non-reset outgoing weight, where $\mathrm{rw}=f(w_r)$. Then we can substitute and solve:

\begin{align*}
\frac{n_kf(\theta_k)}{\sum\limits_j n_jf(\theta_j)} &= \frac{n_kf(\theta_k')}{\sum\limits_j n_jf(\theta_j')}\\
\frac{n_kf(\theta_k)}{\left[\frac{(1-\alpha)f(w_r)}{\alpha}\right]} &= \frac{n_kf(\theta_k')}{z-\mathrm{rw}}\\
f(\theta_k) &= \frac{f(\theta_k')(1-\alpha)f(w_r)}{\alpha(z-\mathrm{rw})}\\
\theta_k &= f^{-1}\left(\frac{f(\theta_k')(1-\alpha)\mathrm{rw}}{\alpha(z-\mathrm{rw})}\right)
\end{align*}

\subsection*{Solution 3: Boost reset feature}
Now we will consider boosting the reset feature {\tt id(alphaBooster)}. First we solve for $w_r$:

\begin{align*}
\frac{f(w_r)}{f(w_r) + \sum\limits_i f(w_i)} & =   \alpha\\
f(w_r) &= \alpha(f(w_r) + \sum\limits_i f(w_i))\\
f(w_r) &= \frac{\alpha}{1-\alpha}\sum\limits_i f(w_i)\\
w_r &= f^{-1}\left(\frac{\alpha}{1-\alpha}\sum\limits_i f(w_i)\right)\\
\end{align*}

Now we decompose $w_r$ into its component parts:

$$w_r = \sum\limits_i \theta_i\phi_i$$

where $\phi$ is the reset feature vector. We wish to modify only the {\tt alphaBooster} feature, which we can then express:

$$\theta_{\alpha B} = \frac{w_r - \sum\limits_{i\ne\alpha B} \theta_i\phi_i}{\phi_{\alpha B}}$$

we can then substitute our earlier expression for $w_r$, followed by the $z$ and $\mathrm{rw}$ subsitution as before:

\begin{align*}
\theta_{\alpha B} = \frac{f^{-1}\left(\frac{\alpha}{1-\alpha}\sum\limits_i f(w_i)\right) - \sum\limits_{i\ne\alpha B} \theta_i\phi_i}{\phi_{\alpha B}} \\
\theta_{\alpha B} = \frac{f^{-1}\left(\frac{\alpha}{1-\alpha}(z-\mathrm{rw})\right) - \sum\limits_{i\ne\alpha B} \theta_i\phi_i}{\phi_{\alpha B}} \\
\end{align*}

\end{document}
